# GitHub Secrets ì„¤ì • ê°€ì´ë“œ

## ğŸ”§ GitHub Secrets ì„¤ì •

GitHub ì €ì¥ì†Œì˜ Settings â†’ Secrets and variables â†’ Actionsì—ì„œ ë‹¤ìŒ ì‹œí¬ë¦¿ì„ ì„¤ì •í•˜ì„¸ìš”:

### **í•„ìˆ˜ ì‹œí¬ë¦¿**

| ì‹œí¬ë¦¿ ì´ë¦„ | ì„¤ëª… | ì˜ˆì‹œ ê°’ |
|------------|------|---------|
| `DEPLOY_HOST` | ì„œë²„ IP ì£¼ì†Œ | `49.247.4.194` |
| `DEPLOY_USER` | ì„œë²„ ì‚¬ìš©ìëª… | `admin` |
| `DEPLOY_SSH_KEY` | SSH ê°œì¸í‚¤ (ì „ì²´ ë‚´ìš©) | `-----BEGIN OPENSSH PRIVATE KEY-----...` |
| `DEPLOY_PATH` | ì„œë²„ì˜ í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ | `/home/admin/projects/mincenter` |

### **SSH í‚¤ ì„¤ì • ë°©ë²•**

1. **ë¡œì»¬ì—ì„œ SSH í‚¤ ìƒì„±** (ì´ë¯¸ ìˆë‹¤ë©´ ìƒëµ):
   ```bash
   ssh-keygen -t rsa -b 4096 -C "github-actions@mincenter.kr"
   ```

2. **ì„œë²„ì— ê³µê°œí‚¤ ë“±ë¡**:
   ```bash
   ssh-copy-id -i ~/.ssh/id_rsa.pub admin@49.247.4.194
   ```

3. **GitHubì— ê°œì¸í‚¤ ë“±ë¡**:
   - `~/.ssh/id_rsa` íŒŒì¼ì˜ ì „ì²´ ë‚´ìš©ì„ ë³µì‚¬
   - GitHub Secretsì˜ `DEPLOY_SSH_KEY`ì— ë¶™ì—¬ë„£ê¸°

## ğŸš€ ì›Œí¬í”Œë¡œìš° ì„¤ëª…

### **1. ìë™ ë°°í¬ (`deploy.yml`)**

**íŠ¸ë¦¬ê±° ì¡°ê±´:**
- `main` ë¸Œëœì¹˜ì— push
- PRì´ `main` ë¸Œëœì¹˜ì— ë¨¸ì§€ë¨

**ë™ì‘ ë°©ì‹:**
1. **ë³€ê²½ ê°ì§€**: Git diffë¡œ ë³€ê²½ëœ íŒŒì¼ ë¶„ì„
2. **ì„ íƒì  ë°°í¬**: ë³€ê²½ëœ ì»´í¬ë„ŒíŠ¸ë§Œ ë°°í¬
3. **í—¬ìŠ¤ì²´í¬**: ë°°í¬ í›„ ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸

### **2. í…ŒìŠ¤íŠ¸ (`test.yml`)**

**íŠ¸ë¦¬ê±° ì¡°ê±´:**
- PR ìƒì„±/ìˆ˜ì •
- `main`, `develop` ë¸Œëœì¹˜ì— push

**ë™ì‘ ë°©ì‹:**
1. **í”„ë¡ íŠ¸ì—”ë“œ í…ŒìŠ¤íŠ¸**: Site, Admin ê°ê° í…ŒìŠ¤íŠ¸
2. **ë°±ì—”ë“œ í…ŒìŠ¤íŠ¸**: API í…ŒìŠ¤íŠ¸ ë° ë¹Œë“œ
3. **ë³´ì•ˆ ê²€ì‚¬**: Trivyë¡œ ì·¨ì•½ì  ìŠ¤ìº”

### **3. ìˆ˜ë™ ë°°í¬ (`manual-deploy.yml`)**

**ì‚¬ìš© ë°©ë²•:**
1. GitHub ì €ì¥ì†Œ â†’ Actions íƒ­
2. "Manual Deploy" ì›Œí¬í”Œë¡œìš° ì„ íƒ
3. "Run workflow" í´ë¦­
4. ë°°í¬ ëŒ€ìƒ ë° í™˜ê²½ ì„ íƒ

### **4. SSH ì—°ê²° í…ŒìŠ¤íŠ¸ (`test-ssh.yml`)**

**ì‚¬ìš© ë°©ë²•:**
1. GitHub ì €ì¥ì†Œ â†’ Actions íƒ­
2. "Test SSH Connection" ì›Œí¬í”Œë¡œìš° ì„ íƒ
3. "Run workflow" í´ë¦­

**í™•ì¸ ì‚¬í•­:**
- SSH ì—°ê²° ì„±ê³µ ì—¬ë¶€
- ì„œë²„ ì •ë³´ (í˜¸ìŠ¤íŠ¸ëª…, IP, ì‚¬ìš©ì)
- ë°°í¬ ê²½ë¡œ ì¡´ì¬ ì—¬ë¶€
- Docker ë° Docker Compose ì„¤ì¹˜ ì—¬ë¶€

## ğŸ” ë¬¸ì œ í•´ê²°

### **SSH ì—°ê²° ì‹¤íŒ¨ ì‹œ**

#### **1. SSH í‚¤ í™•ì¸**
```bash
# ë¡œì»¬ì—ì„œ SSH í‚¤ í™•ì¸
ls -la ~/.ssh/
cat ~/.ssh/id_rsa.pub

# ì„œë²„ì—ì„œ authorized_keys í™•ì¸
ssh admin@49.247.4.194 "cat ~/.ssh/authorized_keys"
```

#### **2. SSH ì—°ê²° í…ŒìŠ¤íŠ¸**
```bash
# ë¡œì»¬ì—ì„œ ì§ì ‘ SSH ì—°ê²° í…ŒìŠ¤íŠ¸
ssh -i ~/.ssh/id_rsa admin@49.247.4.194

# ì—°ê²° ì„±ê³µ ì‹œ ì„œë²„ì— ì ‘ì†ë¨
# ì—°ê²° ì‹¤íŒ¨ ì‹œ ì˜¤ë¥˜ ë©”ì‹œì§€ í™•ì¸
```

#### **3. GitHub Secrets ì¬ì„¤ì •**
1. GitHub ì €ì¥ì†Œ â†’ Settings â†’ Secrets and variables â†’ Actions
2. ê¸°ì¡´ ì‹œí¬ë¦¿ ì‚­ì œ
3. ìƒˆë¡œìš´ ì‹œí¬ë¦¿ ìƒì„±
4. SSH í‚¤ ì „ì²´ ë‚´ìš© ë³µì‚¬ (BEGIN/END ë¼ì¸ í¬í•¨)

#### **4. ì„œë²„ SSH ì„¤ì • í™•ì¸**
```bash
# ì„œë²„ì—ì„œ SSH ì„¤ì • í™•ì¸
sudo cat /etc/ssh/sshd_config | grep -E "(Port|PasswordAuthentication|PubkeyAuthentication)"

# SSH ì„œë¹„ìŠ¤ ì¬ì‹œì‘
sudo systemctl restart sshd
```

### **ë°°í¬ ê²½ë¡œ ë¬¸ì œ**

#### **1. ê²½ë¡œ ì¡´ì¬ í™•ì¸**
```bash
# ì„œë²„ì—ì„œ ë°°í¬ ê²½ë¡œ í™•ì¸
ls -la /home/admin/projects/mincenter

# ê²½ë¡œê°€ ì—†ìœ¼ë©´ ìƒì„±
mkdir -p /home/admin/projects/mincenter
```

#### **2. ê¶Œí•œ í™•ì¸**
```bash
# ë””ë ‰í† ë¦¬ ê¶Œí•œ í™•ì¸
ls -la /home/admin/projects/

# ê¶Œí•œ ìˆ˜ì • (í•„ìš”ì‹œ)
chmod 755 /home/admin/projects/mincenter
```

## ğŸ“Š ë°°í¬ ì‹œë‚˜ë¦¬ì˜¤

### **ì‹œë‚˜ë¦¬ì˜¤ 1: ì‚¬ì´íŠ¸ UI ìˆ˜ì •**
```bash
# frontends/site/src/routes/+page.svelte ìˆ˜ì • í›„
git add .
git commit -m "feat: ì‚¬ì´íŠ¸ UI ê°œì„ "
git push origin main
```

**ê²°ê³¼:**
- `detect-changes` ì‘ì—…ì—ì„œ `site-changed=true` ê°ì§€
- `deploy-site` ì‘ì—…ë§Œ ì‹¤í–‰
- ì‚¬ì´íŠ¸ ì»¨í…Œì´ë„ˆë§Œ ì¬ì‹œì‘

### **ì‹œë‚˜ë¦¬ì˜¤ 2: API ë¡œì§ ìˆ˜ì •**
```bash
# backends/api/src/handlers/user.rs ìˆ˜ì • í›„
git add .
git commit -m "fix: ì‚¬ìš©ì ì¸ì¦ ë¡œì§ ìˆ˜ì •"
git push origin main
```

**ê²°ê³¼:**
- `detect-changes` ì‘ì—…ì—ì„œ `api-changed=true` ê°ì§€
- `deploy-api` ì‘ì—…ë§Œ ì‹¤í–‰
- API ë¹Œë“œ ë° ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘

### **ì‹œë‚˜ë¦¬ì˜¤ 3: í™˜ê²½ë³€ìˆ˜ ë³€ê²½**
```bash
# .env íŒŒì¼ ìˆ˜ì • í›„
git add .
git commit -m "chore: í™˜ê²½ë³€ìˆ˜ ì—…ë°ì´íŠ¸"
git push origin main
```

**ê²°ê³¼:**
- `detect-changes` ì‘ì—…ì—ì„œ `env-changed=true` ê°ì§€
- `deploy-env` ì‘ì—…ë§Œ ì‹¤í–‰
- ëª¨ë“  ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘

## ğŸš¨ ì£¼ì˜ì‚¬í•­

### **1. SSH í‚¤ ë³´ì•ˆ**
- SSH í‚¤ëŠ” ì ˆëŒ€ ê³µê°œ ì €ì¥ì†Œì— ì»¤ë°‹í•˜ì§€ ë§ˆì„¸ìš”
- GitHub Secretsì—ë§Œ ì €ì¥í•˜ì„¸ìš”
- ì •ê¸°ì ìœ¼ë¡œ SSH í‚¤ë¥¼ êµì²´í•˜ì„¸ìš”

### **2. ë°°í¬ ê²½ë¡œ**
- `DEPLOY_PATH`ëŠ” ì„œë²„ì˜ ì‹¤ì œ ê²½ë¡œì™€ ì¼ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤
- ê²½ë¡œì— ê³µë°±ì´ë‚˜ íŠ¹ìˆ˜ë¬¸ìê°€ ì—†ì–´ì•¼ í•©ë‹ˆë‹¤
- ì‚¬ìš©ìê°€ í•´ë‹¹ ê²½ë¡œì— ì“°ê¸° ê¶Œí•œì´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤

### **3. ì„œë²„ ìƒíƒœ**
- ë°°í¬ ì „ ì„œë²„ê°€ ì •ìƒ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”
- ì¶©ë¶„í•œ ë””ìŠ¤í¬ ê³µê°„ì´ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”
- Docker ì„œë¹„ìŠ¤ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš” 